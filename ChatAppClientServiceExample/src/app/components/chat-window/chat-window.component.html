<div class="chat-content">
  <!-- Header displaying recipient information -->
  <app-chat-header *ngIf="recipientInfo" [recipientInfo]="recipientInfo"></app-chat-header>

  <div class="chat-window" *ngIf="recipientId; else selectChatMessage">
    <div class="chat-messages" #chatMessages>
      <!-- Loop to display messages -->
      <div *ngFor="let message of messages; let i = index"
           class="message-wrapper"
           [ngClass]="{'sent': message.userId === currentUserId, 'received': message.userId !== currentUserId}">
        <!-- Sender's name in a group chat -->
        <p *ngIf="message.groupId" class="sender-name">{{ message.senderFullName }}</p>

        <!-- Display message content if available -->
        <div *ngIf="message.message" class="message-content">
          {{ message.message }}
        </div>

        <!-- Display attachments if available -->
        <div *ngIf="message.attachmentUrl" class="attachment">
          <ng-container [ngSwitch]="getAttachmentType(message.attachmentUrl)">
            <!-- Image attachment -->
            <img *ngSwitchCase="'image'" [src]="getAttachmentUrl(message.attachmentUrl)" alt="Image attachment"
                 (click)="openAttachmentPreview(message.attachmentUrl, 'image')" style="cursor: pointer;" />

            <!-- Video attachment -->
            <video *ngSwitchCase="'video'" controls [src]="getAttachmentUrl(message.attachmentUrl)"
                   (click)="openAttachmentPreview(message.attachmentUrl, 'video')" style="cursor: pointer;"></video>

            <!-- Audio attachment -->
            <audio *ngSwitchCase="'audio'" controls [src]="getAttachmentUrl(message.attachmentUrl)" style="width: 100%;"></audio>

            <!-- PDF attachment -->
            <a *ngSwitchCase="'pdf'" [href]="getAttachmentUrl(message.attachmentUrl)" target="_blank">
              <i class="fas fa-file-pdf"></i> {{ message.attachmentOriginalName }}
            </a>

            <!-- DOCX attachment -->
            <a *ngSwitchCase="'docx'" [href]="getAttachmentUrl(message.attachmentUrl)" target="_blank">
              <i class="fas fa-file-word"></i> {{ message.attachmentOriginalName }}
            </a>

            <!-- Other attachments -->
            <a *ngSwitchDefault [href]="getAttachmentUrl(message.attachmentUrl)" target="_blank">
              {{ message.attachmentOriginalName }}
            </a>
          </ng-container>
        </div>

        <!-- Display 'Read' status if this is the last read message -->
        <div *ngIf="message.isRead && message.userId === currentUserId && i === messages.length - 1" class="message-status">
          Seen
        </div>
      </div>
    </div>

    <!-- Message input area -->
    <div class="message-input" *ngIf="recipientId">
      <div class="emoji-picker">
        <i class="fas fa-smile" (click)="onEmojiClick()" title="Insert emoji"></i>
      </div>

      <input type="text" [(ngModel)]="newMessage" placeholder="Type a message..."
             (keydown.enter)="onSendMessage()" aria-label="Type a message" />

      <label for="fileInput" class="icon-button">
        <i class="fas fa-paperclip"></i>
      </label>
      <input type="file" id="fileInput" (change)="onFileSelected($event)" #fileInput style="display: none;" />

      <button (click)="onSendMessage()" [disabled]="!newMessage.trim() && !attachmentFile" class="icon-button">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <!-- Template for the select chat message -->
  <ng-template #selectChatMessage>
    <div class="select-chat-message">
      <p>Please select a conversation or user to view the chat messages.</p>
    </div>
  </ng-template>
</div>
